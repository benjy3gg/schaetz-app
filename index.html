<!doctype html>
<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
    crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
    crossorigin="anonymous"></script>
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <link rel="stylesheet" href="css/animate.css">
  <link rel="stylesheet" href="css/style.css">
  <script src="js/vue.js"></script>
  <script src="js/colors.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
  <script src="https://unpkg.com/vuex@2.0.0"></script>
  <title>Schätz-App</title>
</head>

<body>
  <div class="container">
    <h1>Hallo Schätzchen:
      <span id="name"></span>
    </h1>
  </div>
  <div class="container">
    <div class="row align-items-center" id="card-deck"></div>
  </div>


  <script>
    $(function () {
      //$('#emoji-picker').emojiPicker();

      var sizes = ['1', '2', '3', '5', '8', '13', '21', '34', '55', '?'];
      var socket = io();

      socket.on('user wait', function () {
        $('#card-deck').empty();
        $('#card-deck').html('<h1>Please wait</h1>');
      });

      socket.on('user can vote', function () {
        drawCards(sizes);
      });

      socket.on('card reset', function () {
        drawCards(sizes);
      });

      var user = {};

      var person = prompt("Please enter your name", "Harry Potter");
      $('#name').html(person);
      user.name = person;

      if (!localStorage['imageUrl']) {
        var urlPrompt = prompt("enter your avatar image", "https://media.giphy.com/media/xUNd9FzxmXhhaD3tvO/200w_d.gif");
        localStorage['imageUrl'] = urlPrompt;
      } else {
        urlPrompt = localStorage['imageUrl'];
      }

      user.urlPrompt = urlPrompt;

      var roomCode = prompt("enter room code", "12345");
      user.roomCode = roomCode;
      if (user) {
        socket.emit('room', user);
      }

      /*socket.on('chef connected', function () {
        alert("chef ist da");
        socket.emit('room', roomCode);
      });*/

      socket.on('no chef', function () {
        document.body.innerHTML += ("<h1>Kein chef da</h1>")
      })

      socket.on('drop', function (roomCode) {
        socket.emit("drop user", roomCode);
      })

      socket.on('drop', function (roomCode) {
        $('#card-deck').empty();
        document.body.innerHTML += ("<h1>Kein chef da</h1>")
      })

      function drawCards(sizes) {
        $('#card-deck').empty();
        $.each(sizes, function (index, size) {
          $('#card-deck').append(
            cardHtml(size, urlPrompt, person)
          );
        });
        $('.card-container-card-container').click(function (item) {
          if ($(this).data('clickable') === true) {
            $('.card-container-card-container').data('clickable', false);
            var card_value = $(this).find('.card-container-card').data("value");
            var data = { "user": user, "card_value": card_value };
            socket.emit('user send vote', data);
            $('.manual-flip:not([data-value="' + card_value + '"]').addClass('hover')
          }
        });
      }

      function cardHtml(size, urlPrompt, person) {
        return `
        <div class="col-xl-2 col-md-6 col-lg-4 animated bounceInDown card-container-card-container" data-clickable="true">
          <div class="card-container-card manual-flip" data-value="${size}">
            <div class="card">
              <div class="front">
                  <div class="user">
                  <img class="img-circle" src="${urlPrompt}" />
                </div>
                <div class="content">
                  <div class="main">
                    <h3 class="name">${size}</h3>
                  </div>
                </div>              
              </div>
              <!-- end front panel -->
              <div class="back">
                <div class="header">
                  <h5 class="motto">"Die Spannung steigt!!!"</h5>
                </div>
              </div>
              <!-- end back panel -->
              </div>
            <!-- end card -->
          </div>
          <!-- end card-container -->
      </div>`
      }

    });
  </script>
</body>

</html>
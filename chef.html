<!doctype html>
<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
    crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
    crossorigin="anonymous"></script>
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <link href="css/animate.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <title>Schätz-App</title>
</head>

<body>
  <div class="container">
    <h1 class="display-3">Schätz-App
      <span id="roomCode"></span>
    </h1>
  </div>

  <div class="container">
    <div class="clearfix">
      <button class="btn btn-success float-left" id="show">Karten anzeigen
        <span id="counter">0</span> von
        <span id="users">-1</span>
      </button>
      <button class="btn btn-warning float-right text-light" id="reset">Neu schätzen</button>
    </div>
  </div>
  <!--<div id="iframe"></div>-->
  <div class="container">
    <div class="row mt-3" id="card-container">

    </div>
  </div>

  </div>
  <script>
    $(function () {

      $.fn.extend({
        animateCss: function (animationName, callback) {
          var animationEnd = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
          this.addClass('animated ' + animationName).one(animationEnd, function () {
            $(this).removeClass('animated ' + animationName);
            if (callback) {
              callback($(this));
            }
          });
          return this;
        }
      });
      var socket = io();
      var sizes = ['Training', 'Amateur', 'Semi-Pro', 'Pro', 'World-Class', 'Legendary'];

      socket.emit('set sizes', sizes);
      var roomCode = prompt("enter a room code", "12345");
      if (roomCode) {
        $('#roomCode').html("Room-Code: " + roomCode);
        socket.emit('room', roomCode);
        socket.emit('chef connected', roomCode);
      }


      socket.on('user connected', function (msg) {
        $('#users').html(parseInt($('#users').html()) + 1);
      })
      socket.on('card draw', function (msg) {
        numCards = $('#card-container').children().length;
        $('#counter').html(parseInt($('#counter').html()) + 1);
        $('#card-container').append(cardHtml(numCards, msg));
      });

      drawNew();

      /*$('#url').on("keypress", function (event) {
        if (event.which == 13 && !event.shiftKey) {
          $('#iframe').html('<iframe width="500px" height="500px" src="">');
        }
      });*/

      $('#reset').click(function () {
        $('#counter').html(0);
        $('.card-container-card').animateCss('bounceOutLeft', function (element) {
          $(element).closest('.card-container-card-container').remove();
        });

        socket.emit('card reset');
        drawNew();
      });

      $('#show').click(function () {
        $('.card-container-card').toggleClass('hover');
      })

      function drawNew() {
        $('.card-container').empty();
      };

      function cardHtml(numCards, msg) {
        return `
        <div class="col-md-4 col-sm-6 animated bounceInDown card-container-card-container">
          <div class="card-container-card manual-flip" style="animation-delay: ${numCards * 0.3}s; transition-delay: ${numCards * 0.1}s;" data-value="${msg.card_value}" data-rotation="${Math.random() * 45 - 20}">
            <div class="card" style="transition-delay: ${numCards * 0.3}s;">
              <div class="front">
                <div class="header">
                  <h5 class="motto">"Die Spannung steigt!!!"</h5>
                </div>
              </div>
              <!-- end front panel -->
              <div class="back">
                <div class="user">
                  <img class="img-circle" src="${msg.url}" />
                </div>
                <div class="content">
                  <div class="main">
                    <h3 class="name">${msg.name}</h3>
                    <p class="profession">${msg.card_value}</p>
                  </div>
                </div>
              </div>
              <!-- end back panel -->
              </div>
            <!-- end card -->
          </div>
          <!-- end card-container -->
      </div>`
      }
    });
  </script>
</body>

</html>
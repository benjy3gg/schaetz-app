<!doctype html>
<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
    crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
    crossorigin="anonymous"></script>
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/holder/2.9.4/holder.js"></script>

  <title>Socket.IO chat</title>
  <style>
    .card-deck {
      margin-top: 10px;
      height: 100px;
    }

    .card {
      margin-left: 0px !important;
      margin-right: 0px !important;
    }

    .card-img-top {
      object-fit: cover;
      height: 72px;
    }

    /* entire container, keeps perspective */

    .flip-container {
      perspective: 1000px;
    }

    /* flip the pane when hovered */

    .flip-container:hover .flipper,
    .flip-container.hover .flipper {
      transform: rotateY(180deg);
    }

    .flip-container,
    .front,
    .back {
      width: 100px;
      height: 100px;
    }

    /* flip speed goes here */

    .flipper {
      transition: 0.6s;
      transform-style: preserve-3d;

      position: relative;
    }

    /* hide back of pane during swap */

    .front,
    .back {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;

      position: absolute;
      top: 0;
      left: 0;
    }

    /* front pane, placed above back */

    .front {
      z-index: 2;
      /* for firefox 31 */
      transform: rotateY(0deg);
    }

    /* back, initially hidden pane */

    .back {
      transform: rotateY(180deg);
    }
  </style>
</head>

<body>
  <div class="jumbotron">
    <div class="container">
      <h1 class="display-3">Schätz-App</h1>
      <h1 class="lead" id="roomCode">Room-Code: ----</h1>
    </div>
  </div>

  <div class="container">
    <div class="clearfix">
      <button class="btn btn-success float-left" id="show">Karten anzeigen
        <span id="counter">0</span> von
        <span id="users">-1</span>
      </button>
      <button class="btn btn-warning float-right" id="reset">Neu schätzen</button>
    </div>
  </div>
  <!--<div id="iframe"></div>-->
  <div class="card-container container"></div>

  </div>
  <script>
    $(function () {
      var socket = io();
      var sizes = ['Training', 'Amateur', 'Semi-Pro', 'Pro', 'World-Class', 'Legendary'];

      socket.emit('set sizes', sizes);
      var roomCode = prompt("enter a room code", "12345");
      if (roomCode) {
        $('#roomCode').html("Room-Code: " + roomCode);
        socket.emit('room', roomCode);
        socket.emit('chef connected', roomCode);
      }


      socket.on('user connected', function (msg) {
        $('#users').html(parseInt($('#users').html()) + 1);
      })
      socket.on('card draw', function (msg) {
        $('#counter').html(parseInt($('#counter').html()) + 1);
        $('#card-deck-' + msg.card_value).append(
          '<div class="col-md-2">\
              <div class="flip-container">\
                <div class="flipper">\
                  <div class="front">\
                  </div>\
                  <div class="back ">\
                      <div class="card">\
                        <img class="card-img-top" src="'+ msg.url + '" alt="Card image cap">\
                        <div class="card-block">\
                          <p class="card-text">'+ msg.name + '</p>\
                        </div>\
                      </div >\
                  </div>\
                </div>\
              </div>\
          </div > '
        );
      });

      drawNew();

      /*$('#url').on("keypress", function (event) {
        if (event.which == 13 && !event.shiftKey) {
          $('#iframe').html('<iframe width="500px" height="500px" src="">');
        }
      });*/

      $('#reset').click(function () {
        $('#counter').html(0);
        $('.flip-container').addClass('animate bounceOutLeft');

        socket.emit('card reset');
        drawNew();
      });

      $('#show').click(function () {
        $('.flip-container').toggleClass("hover");
      })

      function drawNew() {
        $('.card-container').empty();
        $(sizes).each(function (i, size) {
          $('.card-container').append(
            '<div class="card-deck bg-light border border-success text-dark" id="card-deck-' + size + '">\
              <div class="col-md-2">'+ size + '</div>\
            </div>'
          );
        })
      };
    });
  </script>
</body>

</html>